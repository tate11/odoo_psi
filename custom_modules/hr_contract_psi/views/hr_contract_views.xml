<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<record model="ir.actions.act_window" id="action_historical_contract_view_tree">
		<field name="name">Historiques de Contrat</field>
		<field name="res_model">psi.contract.historical</field>
		<field name="view_type">tree</field>
		<field name="view_mode">tree</field>
		<field name="domain">[('contract_id','=',active_id)]</field>
	</record>
	<record id="view_historical_contract_tree" model="ir.ui.view">
		<field name="name">Historique Contrat</field>
		<field name="model">psi.contract.historical</field>
		<field name="arch" type="xml">
			<tree string="Historical Contract">
				<field name="date" />
				<field name="ancien" />
				<field name="nouveau" />
				<field name="historical" />
				<field name="debut" />
				<field name="fin" />
			</tree>
		</field>
	</record>
	
	<record id="hr_contract_view_tree_inherit" model="ir.ui.view">
		<field name="name">Liste Contrats</field>
		<field name="model">hr.contract</field>
		<field name="inherit_id" ref="hr_contract.hr_contract_view_tree"/>
		<field name="arch" type="xml">
			<field name="name" position="before">
				<field name="matricule" />
			</field>
		</field>
	</record>
	
	<record id="hr_contract_view_form_psi" model="ir.ui.view">
		<field name="name">hr.contract.form.psi</field>
		<field name="model">hr.contract</field>
		<field name="inherit_id" ref="hr_contract.hr_contract_view_form" />
		<field name="arch" type="xml">
			<field name="state" position="after">
				<button name="set_employee_inactif" type="object" context="{'send_rfq':True}"
					string="Fin de contrat et notification" class="oe_highlight"
					attrs="{'invisible': ['|', ('motif_rupture','=',False),('state','=','close')]}" />
				<button name="set_employee_inactif" type="object" context="{'send_rfq':True}"
					string="Ré-envoyer la notification - Fin du contrat"
					attrs="{'invisible': ['|',('motif_rupture','=',False),('state_mail','=','draft')]}" />
			</field>
			<field name="employee_id" position="before">
				<field name="matricule" readonly="1" />
			</field>
			<xpath expr="//label" position="before">
				<field name="response_evaluation" invisible="1" />
				<div class="oe_button_box" name="button_box">
					<button class="oe_inline oe_stat_button" type="action"
						name="%(action_historical_contract_view_tree)d" icon="fa-history">
						<field string="Historique" name="historical_count" widget="statinfo" />
					</button>
				</div>
			</xpath>
			<xpath expr="//label[@for='trial_date_start']" position="replace">
				<label for="trial_date_start" string="Période d’essai "/>
			</xpath>
		
			<field name="type_id" position='replace'>
				<field name="type_id" invisible="1" />
				<field name="state_mail" invisible="1" />
			</field>

			<field name="wage" position='after'>
			    <field name="devise" required="1" />
				<field name="psi_category_details" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
				<field name="psi_cat_cat" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
				<field name="psi_sub_category" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
				<field name="psi_echelon" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
			</field>
			
			<xpath expr="//field[@name='department_id']" position='after'>
				<field name="psi_contract_type" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
				<field name="place_of_work" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
			</xpath>

<!-- 			<field name="date_end" position="after">
				<field name="indetermine" class="oe_inline" attrs="{'invisible': [('psi_contract_type','=','cdd')]}" />
			</field>
 -->
			<notebook>
				<page string="Séparation" attrs="{'invisible': ['|', ('motif_rupture','=',False),('state','=','close')]}">
					<group>
						<field name="preavis" attrs="{'invisible': [('motif_rupture','not in','resignation'),('motif_rupture','not in','dismissal')]}"/>
						<field name="date_rupture" attrs="{'readonly' : [('state','=','close')]}" />
					</group>
					<group>
						<button name="action_report_certificat" type="object" string="Générer son certificat de travail" class="oe_highlight" />
            			<separator />
						<button name="action_send_email_desactivate_flottes" string="Demande de désactivation des flottes " type="object"  class="oe_highlight" />
						<separator />
						<button name="action_send_email_desactivate_account" type="object" class="oe_highlight" string="Demande de désactivation de compte (email, etc.)"/>
						<separator />
					</group>
					<group>
						<field name="debauchage_cnaps"/>
						<field name="debauchage_ostie"/>
						<field name="debauchage_assurance"/>
					</group>
				</page>
			</notebook>
			
			<group name="duration_group" position="after">
				<group name="rupture" string="Rupture de contrat">
					<field name="motif_rupture" attrs="{'readonly' : [('state','=','close')]}" />
					<field name="date_demission" attrs="{'readonly' : [('state','=','close')]}" />
				</group>
			</group>
			
			<xpath expr="//group[@name='duration_group']" position="after">
				<group name="result_evaluation" string="Evaluation Période d'essai"> <!-- Condition if date_end_trial terminé -->
					<field name="result_evaluation" attrs="{'readonly' : [('state','=','close')]}"/>
					<label string="Vous voulez renouveler la période d'essai ?"
						confirm="Veuillez confirmer le renouvelement de sa période d'essai."
						attrs="{'invisible':['|','|',('result_evaluation','not in','ko'),('response_evaluation','=','accept')]}" />
					<div>
						<button name="action_renew_trial_accept" string="OUI" type="object"
							class="btn-primary"
							attrs="{'invisible':['|',('result_evaluation','not in','ko'),('response_evaluation','=','accept')]}"
							onClick="$(this).prop('disabled', true);" />
						&#x2063;&#x2063;
						<button name="action_renew_trial_decline" string="NON"
							type="object" class="btn-primary"
							attrs="{'invisible':['|',('result_evaluation','not in','ko'),('response_evaluation','=','accept')]}"
							confirm="Veuillez confirmer si vous ne voulez pas renouvelement sa période d'essai." onClick="$(this).prop('disabled', true);" />
					</div>

					<button name="action_result_evaluation_send_ok" string="Envoyer une notification par mail"
						type="object" class="btn-primary right"
						attrs="{'invisible': [('result_evaluation','not in','ok')]}" />

					<button name="action_result_evaluation_send_ko" string="Envoyer une notification"
						type="object" class="btn-primary right"
						attrs="{'invisible': ['|',('response_evaluation','=',False),('result_evaluation','not in','ko')]}" />
				</group>
			</xpath>
			
			<!-- Contract close - READONLY -->
			<field name='name' position="replace">
				<field name="name" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name='employee_id' position="replace">
				<field name="employee_id" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name='job_id' position="replace">
				<field name="job_id" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<!-- <field name="struct_id" position="replace">
				<field name="struct_id" attrs="{'readonly' : [('state','=','close')]}" />
			</field> -->
			<!-- <field name="schedule_pay" position="replace">
				<field name="schedule_pay" attrs="{'readonly' : [('state','=','close')]}" />
			</field> -->
			<field name="notes" position="replace">
				<field name="notes" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name="advantages" position="replace">
				<field name="advantages" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name="visa_expire" position="replace">
				<field name="visa_expire" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name='department_id' position="replace">
				<field name="department_id" required="1" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name='wage' position="replace">
				<field name="wage" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			
            <group name="duration_group" position="replace">
	            <group name="duration_group" string="Duration">
		            <label for="trial_date_start" string="Durée de la période d'essai"/>
		            <div>
		                <field name="trial_date_start" class="oe_inline" required="1" attrs="{'readonly' : [('state','=','close')]}"/> - <field name="trial_date_end" class="oe_inline" required="1" attrs="{'readonly' : [('state','=','close')]}"/>
		            </div>
		            <label for="date_start" string="Durée du contrat"/>
		            <div>
		                <field name="date_start" class="oe_inline" attrs="{'readonly' : [('state','=','close')]}"/> - <field name="date_end" required="1" class="oe_inline" attrs="{'readonly' : [('state','=','close')]}"/>
		            </div>
		            <field name="working_hours" attrs="{'readonly' : [('state','=','close')]}"/>
		        </group>
            </group>
			
			<field name="working_hours" position="before">
				<field name="work_years" attrs="{'readonly' : True}" />
			</field>
			<field name='visa_no' position="replace">
				<field name="visa_expire" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name='visa_expire' position="replace">
				<field name="visa_expire" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
			<field name='permit_no' position="replace">
				<field name="permit_no" attrs="{'readonly' : [('state','=','close')]}" />
			</field>
		</field>
	</record>



	<!-- Resume and Letters -->
	<record id="hr_contract.ir_attachment_view_search_inherit_hr_employee"
		model="ir.ui.view">
		<field name="name">ir.attachment.search.inherit.contract</field>
		<field name="model">ir.attachment</field>
		<field name="mode">primary</field>
		<field name="inherit_id" ref="base.view_attachment_search" />
		<field name="arch" type="xml">
			<xpath expr="//field[@name='create_date']" position="after">
				<field name="index_content" string="Content" />
			</xpath>
			<xpath expr="//filter[@name='my_documents_filter']" position="attributes">
				<attribute name='invisible'>1</attribute>
			</xpath>
			<xpath expr="//filter[@name='url_filter']" position="attributes">
				<attribute name='invisible'>1</attribute>
			</xpath>
			<xpath expr="//filter[@name='binary_filter']" position="attributes">
				<attribute name='invisible'>1</attribute>
			</xpath>
		</field>
	</record>


	<record id="hr_contract_form_view_psi_category" model="ir.ui.view">
		<field name="name">hr.psi.category.form</field>
		<field name="model">hr.psi.category</field>
		<field name="arch" type="xml">
			<form string="Form psi category">
				<field name="psi_category_ids">
					<tree string="PSI Category" editable="bottom" create="false"
						delete="false">
						<field name="psi_professional_category" readonly="1" />
						<field name="prior_notice" />
						<field name="test_duration" />
					</tree>
				</field>
			</form>
		</field>
	</record>

	<record id="open_contract_category" model="ir.actions.act_window">
		<field name="name">Catégories proféssionnelles</field>
		<field name="res_model">hr.psi.category</field>
		<field name="res_id" eval="ref('hr_recruitment_psi.psi-category')" />
		<field name="view_type">form</field>
		<field name="view_mode">form</field>
		<field name="domain">[]</field>
		<field name="context">{}</field>
		<field name="view_id" ref="hr_contract_form_view_psi_category" />
		<field name="help" type="html">
			<p class="oe_view_nocontent_create">
				Catégories proféssionnelles
			</p>
		</field>
	</record>

	<record id="hr_contract_form_view_wage_grids" model="ir.ui.view">
		<field name="name">hr.wage.grid.form</field>
		<field name="model">hr.wage.grid</field>
		<field name="arch" type="xml">
			<form string="form grille salariale">
				<field name="wage_grid_details">
					<tree string="Wage Grid Details" editable="bottom">
						<field name="psi_professional_category" readonly="1" />
						<field name="name" readonly="1" />
						<field name="psi_category" readonly="1" />
						<field name="psi_sub_category" readonly="1" />
						<field name="echelon_1" />
						<field name="echelon_2" />
						<field name="echelon_3" />
						<field name="echelon_4" />
						<field name="echelon_5" />
						<field name="echelon_6" />
						<field name="echelon_7" />
						<field name="echelon_8" />
						<field name="echelon_9" />
						<field name="echelon_10" />
						<field name="echelon_11" />
						<field name="echelon_12" />
						<field name="echelon_13" />
						<field name="echelon_14" />
						<field name="echelon_15" />
						<field name="echelon_16" />
						<field name="echelon_17" />
						<field name="echelon_18" />
						<field name="echelon_19" />
						<field name="echelon_20" />
						<field name="echelon_hc" readonly="1"/>
					</tree>
				</field>
			</form>
		</field>
	</record>

	<record id="open_contract_wage_grid" model="ir.actions.act_window">
		<field name="name">Grille Salariale</field>
		<field name="res_model">hr.wage.grid</field>
		<field name="res_id" eval="ref('grid-salariale')"/>
		<field name="view_type">form</field>
		<field name="view_mode">form</field>
		<field name="domain">[]</field>
		<field name="context">{}</field>
		<field name="view_id" eval="hr_contract_form_view_wage_grids" />
		<field name="help" type="html">
			<p class="oe_view_nocontent_create">
				Grille Salariale
			</p>
		</field>
	</record>

	<record id="hr_contract_birthday_view_calendar" model="ir.ui.view">
		<field name="name">Calendrier des dates d'anniversaire de l'employés
		</field>
		<field name="model">hr.contract</field>
		<field name="arch" type="xml">
			<calendar date_start="anniversary" 
				color="employee_id"
				display="[name_employee], [job_name]" 
				mode="month"
				>
				
				<field name="name_employee" />
				<field name="job_name" />
			</calendar>
		</field>
	</record>

	<!-- ACTIONS -->
	<record id="action_hr_employee_reporting_birthday" model="ir.actions.act_window">
		<field name="name">Calendrier des dates d'anniversaire</field>
		<field name="res_model">hr.contract</field>
		<field name="view_type">form</field>
		<field name="view_mode">calendar</field>
		<field name="view_id" ref="hr_contract_birthday_view_calendar" />
	</record>
	
	<!-- SEARCH PREAVIS -->
    <record id="hr_duree_preavis_filter" model="ir.ui.view">
        <field name="name">hr.duree.preavis.filter</field>
        <field name="model">hr.duree.preavis</field>
        <field name="arch" type="xml">
            <search string="Recherche">
                <filter string="Préavis" domain="[]" context="{'group_by': 'preavis'}" />
	            <filter string="Catégorie" domain="[]" context="{'group_by': 'sous_cat_cat'}" />
	            <filter string="Ancienneté" domain="[]" context="{'group_by': 'name'}" />
             
                <field name="name"/>         
                <field name="preavis"/>
                <field name="sous_cat_cat"/>
            </search>
        </field>
   </record>
               
	<!-- VUE PREAVIS -->
	<record id="hr_duree_preavis_view_pivot" model="ir.ui.view">
		<field name="name">hr.duree.preavis.pivot</field>
		<field name="model">hr.duree.preavis</field>
		<field name="arch" type="xml">
			<pivot string="Durée du Préavis">
				<field name="name" type="row" />
				<field name="sous_cat_cat" type="col" />
				<field name="preavis" type="measure" />
			</pivot>
		</field>
	</record>
	
	<record id="hr_duree_preavis_view_tree" model="ir.ui.view">
		<field name="name">hr.duree.preavis.tree</field>
		<field name="model">hr.duree.preavis</field>
		<field name="arch" type="xml">
			<tree string="Liste des durée du préavis">
				<field name="name" />
				<field name="sous_cat_cat" />
				<field name="categorie" />
				<field name="sous_cat" />
				<field name="preavis" />
			</tree>
		</field>
	</record>
	
	<!-- ACTIONS DUREE PREAVIS-->
	<record id="action_hr_duree_preavis" model="ir.actions.act_window">
		<field name="name">Liste des durées du préavis</field>
		<field name="res_model">hr.duree.preavis</field>
		<field name="view_type">form</field>
		<field name="view_mode">pivot,form,tree</field>
		<field name="context">{'group_by':'name'}</field>
		<field name="view_id" ref="hr_duree_preavis_view_pivot" />
	</record>
		

	<menuitem id="hr_menu_contract_psi_config" parent="hr.menu_hr_root"
	  sequence="6" name="PSI Configuration" />
	 <menuitem id="menu_contract_wage_grid" action="open_contract_wage_grid"
	  parent="hr_menu_contract_psi_config" sequence="5" />
	 <menuitem id="menu_contract_category" action="open_contract_category"
	  parent="hr_menu_contract_psi_config" sequence="11" />
	 <menuitem id="hr_menu_contract_rapport" parent="hr.menu_hr_root"
	  sequence="4" name="Rapports" />
	 <menuitem id="hr_menu_contract_rapport_anniversaire" action="action_hr_employee_reporting_birthday"
	  parent="hr_menu_contract_rapport" sequence="8" />
	 <menuitem id="hr_menu_duree_preavis" action="action_hr_duree_preavis"
	  parent="hr_menu_contract_psi_config" sequence="4" />
	  
</odoo>
