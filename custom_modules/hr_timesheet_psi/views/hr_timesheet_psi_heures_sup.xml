<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<record id="hr_timesheet_sheet_tree_simplified" model="ir.ui.view">
		<field name="name">hr.timesheet.psi.tree</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="arch" type="xml">
			<tree string="Timesheets">
				<field name="employee_id" />
				<field name="date" />
				<field name="time_from" widget="float_time" />
				<field name="time_to" widget="float_time" />
				<field name="department_id" invisible="1" />
				<field name="state" />
				<field name="message_needaction" invisible="1" />
			</tree>
		</field>
	</record>

	<record id="hr_timesheet_psi_form" model="ir.ui.view">
		<field name="name">hr.timesheet.psi.form</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="arch" type="xml">
			<form string="Timesheet">
				<header>
					<button name="action_timesheet_confirm"
						string="Soumettre pour validation" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('is_user_connected','=',False), ('state','!=','draft')]}" />
					<button name="action_timesheet_done" states="confirm"
						string="Valider cette demande" type="object"
						groups="hr_holidays_psi.group_hr_holidays_sup_hierarchique" class="oe_highlight" />
					<button name="action_timesheet_draft" states="done"
						string="Mettre en brouillon" type="object"
						groups="base.group_no_one" />
					<button name="action_timesheet_draft" states="confirm"
						string="Refuser" type="object" 
						groups="hr_holidays_psi.group_hr_holidays_sup_hierarchique" />
					<field name="state" widget="statusbar" statusbar_visible="draft,confirm,done" />
				</header>
				<sheet>
					<div class="oe_title">
						<label for="employee_id" class="oe_edit_only" />
						<h1>
							<field name="employee_id" class="oe_inline" placeholder="Employee's Name" attrs="{'readonly': True}" />
						</h1>
						<field name="user_id" invisible="1" />
					</div>
					<group>
						<group>
							
							<field name="project_id_heure_sup"
								options="{'no_quick_create': True, 'no_create_edit' : True}"
								attrs="{'invisible': [('project_choice', 'not in', 'heure_sup')], 'required':True, 'readonly': [('state', '=', 'done')]}" />
								
							<field name="motif" attrs="{'readonly': [('state', '=', 'done')]}" />
							<field name="date" attrs="{'readonly': [('state', '=', 'done')]}" />
							<label for="time_from" string="Intervalle d'heures" />
							<div>
								<field name="time_from" class="oe_inline" widget="float_time"
									sum="Hours" attrs="{'readonly': [('state', '=', 'done')]}" />
								-
								<field name="time_to" class="oe_inline" widget="float_time"
									sum="Hours" attrs="{'readonly': [('state', '=', 'done')]}" />
								=
								<field name="difference_hours" />
							</div>

							<field name="name" invisible="1" />
							<field name="department_id" invisible="1" />
							<field name="project_choice" invisible="1" />
							<field name="is_user_connected" invisible="1" />
							<field name="company_id" groups="base.group_multi_company" />
						</group>
					</group>
				</sheet>
				<div class="oe_chatter">
					<field name="message_follower_ids" widget="mail_followers" />
					<field name="message_ids" widget="mail_thread" />
				</div>
			</form>
		</field>
	</record>

	<record id="hr_timesheet_sheet_tree_to_validate" model="ir.ui.view">
		<field name="name">hr.timesheet.psi.tree.to.validate</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="arch" type="xml">
			<tree string="Timesheets" create="false">
				<field name="employee_id" />
				<field name="date" />
				<field name="time_from" widget="float_time" />
				<field name="time_to" widget="float_time" />
				<field name="department_id" invisible="1" />
				<field name="state" />
				<field name="message_needaction" invisible="1" />
			</tree>
		</field>
	</record>
	
	<record id="hr_timesheet_psi_form_validate" model="ir.ui.view">
		<field name="name">hr.timesheet.psi.form.validate</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="inherit_id" ref="hr_timesheet_psi_form" />
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="/form" position="attributes">
				<attribute name="create">false</attribute>
				<attribute name="edit">false</attribute>
			</xpath>
		</field>
	</record>
	
	<record id="open_demande_heures_sup" model="ir.actions.act_window">
		<field name="name">Mes demandes d'heures supplémentaires</field>
		<field name="res_model">hr_timesheet_psi.sheet</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form</field>
		<field name="context">{'default_project_choice':'heure_sup'}</field>
		<field name="domain">[('user_id', '=', uid)]</field>
		<field name="help" type="html">
			<p class="oe_view_nocontent_create">
				Nouvelle feuille demande heures supplémentaires.
			</p>
			<p>
				Chaque demande doit être validée par un
				Supérieur Hiérarchique.
			</p>
		</field>
	</record>
	
	<record id="open_heures_sup_a_valider" model="ir.actions.act_window">
		<field name="name">Demandes d'heures supplémentaires à valider</field>
		<field name="res_model">hr_timesheet_psi.sheet</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form</field>
		<field name="context">{'default_project_choice':'heure_sup'}</field>
		<field name="domain">['&amp;',('state', '=', 'confirm'),('user_id.employee_ids.coach_id.user_id','=',uid)]</field>
		<field name="help" type="html">
			<p class="oe_view_nocontent">
			Liste des demandes d'heures supplémentaires à valider
			</p>
		</field>
	</record>
	
	<record model="ir.actions.act_window.view" id="act_timesheet_validate_tree_view">
	    <field eval="1" name="sequence"/>
	    <field name="view_mode">tree</field>
	    <field name="view_id" ref="hr_timesheet_sheet_tree_to_validate"/>
	    <field name="act_window_id" ref="open_heures_sup_a_valider"/>
	</record>
	
	<record model="ir.actions.act_window.view" id="act_timesheet_validate_form_view">
	    <field eval="2" name="sequence"/>
	    <field name="view_mode">form</field>
	    <field name="view_id" ref="hr_timesheet_psi_form_validate"/>
	    <field name="act_window_id" ref="open_heures_sup_a_valider"/>
	</record>
	
	<record id="view_timesheet_grid_psi_heure_sup_inherit" model="ir.ui.view">
		<field name="name">timesheet grid psi heures sup grid</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="view_timesheet_grid_psi" />
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="/grid" position="attributes">
				<attribute name="create">false</attribute>
				<attribute name="edit">false</attribute>
			</xpath>
		</field>
	</record>
	
	<record id="action_timesheet_psi_heures_sup" model="ir.actions.act_window">
		<field name="name">Feuilles de temps heures supplémentaires</field>
		<field name="res_model">account.analytic.line</field>
		<field name="view_mode">grid,tree</field>
		<field name="search_view_id" ref="timesheet_grid.view_timesheet_grid_search" />
		<field name="view_ids"
			eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'grid', 'view_id': ref('view_timesheet_grid_psi_heure_sup_inherit')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('view_timesheet_readonly')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('timesheet_grid.view_timesheet_form')}),
            ]" />
		<field name="domain">['&amp;', ('user_id', '=', uid), ('psi_timesheet_type','=','heure_sup')] 
		</field>
		<field name="context"> { 'user_id': uid, 'grid_range': 'month', 'default_psi_timesheet_type': 'heure_sup' }
		</field>
	</record>
	
	<record id="open_timesheet_psi_heures_sup_all" model="ir.actions.act_window">
		<field name="name">Toutes les feuilles de temps heures supplémentaires</field>
		<field name="res_model">account.analytic.line</field>
		<field name="view_mode">grid,tree</field>
		<field name="search_view_id" ref="view_timesheet_grid_search_psi" />
		<field name="view_ids"
			eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'grid', 'view_id': ref('view_timesheet_grid_psi')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('view_timesheet_readonly')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('my_view_timesheet_form_psi_inherit')}),
            ]" />
		<field name="domain">[('is_timesheet', '=', True),('psi_timesheet_type', '=', 'heure_sup'),('state', '=', 'validate')]</field>
		<field name="context">{'group_by': ['user_id']}</field>
	</record>
	
	<record id="action_timesheet_previous_month_heures_sup_psi" model="ir.actions.act_window">
		<field name="name">Feuilles de temps heures supplémentaires à valider</field>
		<field name="res_model">account.analytic.line</field>
		<field name="view_mode">grid,tree</field>
		<field name="search_view_id" ref="view_timesheet_grid_search_psi" />
		<field name="view_ids"
			eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'grid', 'view_id': ref('view_timesheet_grid_validate_psi')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('view_timesheet_readonly')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('timesheet_grid.view_timesheet_form')}),
            ]" />
		<field name="domain">[('is_timesheet', '=', True),('psi_timesheet_type', '=', 'heure_sup')]</field>
		<field name="context">{
			'grid_anchor': (datetime.date.today() - relativedelta(months=1)).strftime('%Y-%m-%d'), 
			'grid_range': 'month',
			'search_default_nonvalidated': True,
			'group_by': ['user_id','project_id'],
			}
		</field>
	</record>
	
	<menuitem name="Demande heures supplémentaires" id="menu_act_hr_timesheet_psi_my_timesheets"
		parent="hr_timesheet.menu_hr_time_tracking" action="open_demande_heures_sup"
		sequence="20" groups="hr_employee_psi.group_hr_psi_appui_execution" />
		
	<menuitem name="Feuilles de temps heures supplémentaires" id="menu_timesheet_grid_psi_heures_sup"
		parent="hr_timesheet.menu_hr_time_tracking" action="action_timesheet_psi_heures_sup"
		sequence="21" groups="hr_employee_psi.group_hr_psi_appui_execution" />
	
	<menuitem name="Demandes d'heures supplémentaires" id="menu_heures_sup_a_valider"
		parent="hr_timesheet_psi.menu_timesheet_grid_validate" action="open_heures_sup_a_valider"
		sequence="22" groups="hr_holidays_psi.group_hr_holidays_sup_hierarchique" />
		
	<menuitem name="Toutes les feuilles de temps heures supplémentaires" id="menu_timesheet_grid_psi_heures_sup_all"
		parent="hr_timesheet.menu_hr_time_tracking" groups="hr_holidays_psi.group_hr_holidays_rh"
		action="open_timesheet_psi_heures_sup_all" sequence="23" />
		
	<menuitem name="Feuilles de temps heures supplémentaires à valider" id="menu_timesheet_heures_sup_grid_validate"
		parent="hr_timesheet_psi.menu_timesheet_grid_validate" groups="hr_holidays_psi.group_hr_holidays_rh"
		action="action_timesheet_previous_month_heures_sup_psi" sequence="24" />
</odoo>