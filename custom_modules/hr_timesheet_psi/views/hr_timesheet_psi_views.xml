<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<record id="hr_timesheet_sheet_tree_simplified" model="ir.ui.view">
		<field name="name">hr.timesheet.psi.tree</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="arch" type="xml">
			<tree decoration-info="state == 'draft'" decoration-muted="state == 'done'"
				decoration-bf="message_needaction == True" string="Timesheets">
				<field name="employee_id" />
				<field name="time_from" />
				<field name="time_to" />
				<field name="department_id" invisible="1" />
				<field name="state" />
				<field name="message_needaction" invisible="1" />
			</tree>
		</field>
	</record>

	<record id="hr_timesheet_psi_form" model="ir.ui.view">
		<field name="name">hr.timesheet.psi.form</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="arch" type="xml">
			<form string="Timesheet">
				<header>
					<button name="action_timesheet_confirm" states="draft"
						string="Soumettre au responsable" type="object" class="oe_highlight" />
					<button name="action_timesheet_done" states="confirm"
						string="Approuver par le supérieur hiérarchique" type="object"
						groups="hr_timesheet.group_hr_timesheet_user" class="oe_highlight" />
					<button name="action_timesheet_draft" states="done"
						string="Mettre en brouillion" type="object"
						groups="hr_timesheet.group_hr_timesheet_user" />
					<button name="action_timesheet_draft" states="confirm"
						string="Refuser" type="object" groups="hr_timesheet.group_hr_timesheet_user" />
					<field name="state" widget="statusbar" statusbar_visible="new,confirm,done" />
				</header>
				<sheet>
					<div class="oe_title">
						<label for="employee_id" class="oe_edit_only" />
						<h1>
							<field name="employee_id" class="oe_inline" placeholder="Employee's Name" />
						</h1>
						<field name="user_id" invisible="1" />
					</div>
					<group>
						<group>
							<field name="project_id_normal"
								attrs="{'invisible': [('project_choice', 'not in', 'heure_normal')]}" />
							<field name="project_id_heure_sup"
								attrs="{'invisible': [('project_choice', 'not in', 'heure_supp')]}"
								readonly="True" />
							<field name="project_id_prestataire"
								attrs="{'invisible': [('project_choice', 'not in', 'prestataire')]}"
								readonly="True" />
							<field name="motif" />
							<field name="date" />
							<label for="time_from" string="Intervalle d'heures" />
							<div>
								<field name="time_from" class="oe_inline" widget="float_time"
									sum="Hours" />
								-
								<field name="time_to" class="oe_inline" widget="float_time"
									sum="Hours" />
								=
								<field name="hours" />
								Hr(s)
							</div>

							<field name="name" invisible="1" />
							<field name="department_id" invisible="1" />
							<field name="project_time_id" invisible="1" />
							<field name="project_choice" invisible="1" />
							<field name="company_id" groups="base.group_multi_company" />
						</group>
					</group>
				</sheet>
				<div class="oe_chatter">
					<field name="message_follower_ids" widget="mail_followers" />
					<field name="message_ids" widget="mail_thread" />
				</div>
			</form>
		</field>
	</record>

	<record id="view_hr_timesheet_psi_filter" model="ir.ui.view">
		<field name="name">hr_timesheet_psi.sheet.filter</field>
		<field name="model">hr_timesheet_psi.sheet</field>
		<field name="arch" type="xml">
			<search string="Recherche feuille de temps">
				<field name="date_from" />
				<filter name="new" string="En brouillon" domain="[('state','in',('draft', 'new'))]"
					help="Unvalidated Timesheets" />
				<filter name="to_approve" string="A aprouvé" domain="[('state','=','confirm')]"
					help="Confirmed Timesheets" />
				<field name="employee_id" />
				<field name="department_id" />
				<group expand="0" string="Group By">
					<filter string="Employée" domain="[]"
						context="{'group_by':'employee_id'}" />
					<filter string="Type du feuille de temps" domain="[]"
						context="{'group_by':'project_choice'}" />
				</group>
			</search>
		</field>
	</record>

	<record id="act_hr_timesheet_psi_my_timesheets" model="ir.actions.act_window">
		<field name="name">Demande heures supplémentaires</field>
		<field name="res_model">hr_timesheet_psi.sheet</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form</field>
		<field name="context">{'default_project_choice':'heure_supp'}</field>
		<field name="domain">[('employee_id.psi_category', '=', 'execution')]</field>
		<field name="search_view_id" ref="view_hr_timesheet_psi_filter" />
		<field name="help" type="html">
			<p class="oe_view_nocontent_create">
				Nouvelle feuille demande heures supplémentaires.
			</p>
			<p>
				Vous devez remplir votre feuille de temps chaque jour,
				et les
				confirmer à la fin de la semaine.
				Une fois la feuille confirmée, elle
				doit être validée par un
				gestionnaire.
			</p>
		</field>
	</record>

	<record id="view_timesheet_list_psi_inherit" model="ir.ui.view">
		<field name="name">Toutes les feuilles de temps</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="timesheet_grid.view_timesheet_list" />
		<field name="arch" type="xml">
			<field name="task_id" position="attributes">
				<attribute name="invisible">1</attribute>
			</field>
			<field name="project_id" position="after">
				<field name="project_name" invisible="1" />
			</field>
			<field name="project_id" position="replace">
				<field name="project_id"
					options="{'no_quick_create': True, 'no_create_edit' : True}"
					attrs="{'readonly' : [('project_name','=','Absences/Permission/Congés')]}" />
			</field>
			<field name="date" position="replace">
				<field name="date"
					options="{'no_quick_create': True, 'no_create_edit' : True}"
					attrs="{'readonly' : [('project_name','=','Absences/Permission/Congés')]}" />
			</field>
			<field name="name" position="replace">
				<field name="name"
					options="{'no_quick_create': True, 'no_create_edit' : True}"
					attrs="{'readonly' : [('project_name','=','Absences/Permission/Congés')]}" />
			</field>
			<field name="unit_amount" position="replace">
				<field name="unit_amount" string="Durée"
					options="{'no_quick_create': True, 'no_create_edit' : True}"
					attrs="{'readonly' : [('project_name','=','Absences/Permission/Congés')]}" widget="float_time" />
			</field>
		</field>
	</record>


	<record id="my_view_timesheet_list_psi_inherit" model="ir.ui.view">
		<field name="name">Toutes les feuilles de temps</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="timesheet_grid.view_timesheet_list" />
		<field name="arch" type="xml">
	
			<field name="task_id" position="attributes">
				<attribute name="invisible">1</attribute>
			</field>
		</field>
	</record>
	
	<record id="my_view_timesheet_form_psi_inherit" model="ir.ui.view">
		<field name="name">Toutes les feuilles de temps</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="timesheet_grid.view_timesheet_form" />
		<field name="arch" type="xml">
			<xpath expr="/form" position="attributes">
                    <attribute name="create">false</attribute>
                    <attribute name="edit">false</attribute>
                </xpath>
			<field name="task_id" position="attributes">
				<attribute name="invisible">1</attribute>
			</field>
		</field>
	</record>

	<record id="view_timesheet_form_psi_inherit" model="ir.ui.view">
		<field name="name">Timesheet lines for grid psi</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="timesheet_grid.view_timesheet_form" />
		<field name="arch" type="xml">
			<field name="project_id" position="replace">
				<field name="project_id"
					options="{'no_quick_create': True, 'no_create_edit' : True}" />
			</field>
		</field>
	</record>
	<record id="view_timesheet_grid_psi_inherit" model="ir.ui.view">
		<field name="name">timesheet grid psi</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="view_timesheet_grid_psi" />
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="/grid" position="attributes">
				<attribute name="create">false</attribute>
				<attribute name="edit">false</attribute>
			</xpath>
		</field>
	</record>

	<record id="view_timesheet_form_psi_inherit" model="ir.ui.view">
		<field name="name">timesheet form psi</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="timesheet_grid.view_timesheet_form" />
		<field name="arch" type="xml">
			<field name="task_id" position="attributes">
				<attribute name="invisible">1</attribute>
			</field>
		</field>
	</record>
	<record id="action_timesheet_current_psi" model="ir.actions.act_window">
		<field name="name">Ma feuille de temps</field>
		<field name="res_model">account.analytic.line</field>
		<field name="view_mode">grid,tree</field>
		<field name="search_view_id" ref="timesheet_grid.view_timesheet_grid_search" />
		<field name="view_ids"
			eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'grid', 'view_id': ref('view_timesheet_grid_psi_inherit')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('timesheet_grid.view_timesheet_list')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('timesheet_grid.view_timesheet_form')}),
            ]" />
		<field name="domain">['&amp;', ('user_id', '=', uid), ('is_timesheet',
			'=', True)]
		</field>
		<field name="context">
			{
			'user_id': uid,
			'grid_range': 'month'
			}
		</field>
	</record>

	<record id="view_timesheet_grid_psi" model="ir.ui.view">
		<field name="name">Feuilles de temps à valider</field>
		<field name="model">account.analytic.line</field>
		<field name="mode">primary</field>
		<field name="arch" type="xml">

			<grid string="Timesheet" adjustment="object" adjust_name="adjust_grid">
				<field name="project_id" type="row" />
				<field name="date" type="col">
				</field>
				<field name="unit_amount" type="measure" widget="float_time" />
				<empty>
					<p class="oe_view_nocontent_create">
						Click to add projects and tasks
					</p>
					<p>you will be able to register your working hours on the given
						task
					</p>
				</empty>
			</grid>
		</field>
	</record>
	<record id="view_timesheet_grid_readonly_psi" model="ir.ui.view">
		<field name="name">Readonly timesheet grid the psi</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="view_timesheet_grid_psi" />
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="/grid" position="attributes">
				<attribute name="create">false</attribute>
				<attribute name="edit">false</attribute>
			</xpath>
		</field>
	</record>
	<record id="view_timesheet_grid_validate_psi" model="ir.ui.view">
		<field name="name">Feuilles de temps à valider</field>
		<field name="model">account.analytic.line</field>
		<field name="inherit_id" ref="view_timesheet_grid_readonly_psi" />
		<field name="mode">primary</field>
		<field name="arch" type="xml">
			<xpath expr="/grid">
				<button type="object" name="validate" string="Valider" />
			</xpath>
		</field>
	</record>
	<record id="action_timesheet_previous_month_psi" model="ir.actions.act_window">
		<field name="name">Feuilles de temps à valider</field>
		<field name="res_model">account.analytic.line</field>
		<field name="view_mode">grid,tree</field>
		<field name="search_view_id"
			ref="timesheet_grid.view_timesheet_grid_validation_search" />
		<field name="view_ids"
			eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'grid', 'view_id': ref('view_timesheet_grid_validate_psi')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('timesheet_grid.view_timesheet_list')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('timesheet_grid.view_timesheet_form')}),
            ]" />
		<field name="domain">[('is_timesheet', '=', True)]</field>
		<field name="context">{
			'grid_anchor': (datetime.date.today() -
			relativedelta(months=1)).strftime('%Y-%m-%d'), 'grid_range': 'month',
			'search_default_nonvalidated': True,
			}
		</field>
	</record>
	<record id="action_timesheet_all_psi" model="ir.actions.act_window">
		<field name="name">Toutes les feuilles de temps</field>
		<field name="res_model">account.analytic.line</field>
		<field name="view_mode">grid,tree</field>
		<field name="search_view_id" ref="timesheet_grid.view_timesheet_grid_search" />
		<field name="view_ids"
			eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'grid', 'view_id': ref('view_timesheet_grid_readonly_psi')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('my_view_timesheet_list_psi_inherit')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('my_view_timesheet_form_psi_inherit')}),
            ]" />
		<field name="domain">[('is_timesheet', '=', True)]</field>
		<field name="context">{'group_by': ['user_id']}</field>
	</record>
	
	<menuitem  action="act_hr_timesheet_psi_my_timesheets" id="menu_act_hr_timesheet_psi_my_timesheets"
		parent="hr_timesheet.menu_hr_time_tracking" sequence="2" />

	<menuitem name="Ma feuille de temps" id="menu_timesheet_grid_my_psi"
		parent="hr_timesheet.menu_hr_time_tracking" action="action_timesheet_current_psi"
		sequence="0" />

	<menuitem name="Toutes les feuilles de temps" id="timesheet_grid.menu_timesheet_grid_all"
		parent="hr_timesheet.menu_hr_time_tracking" groups="hr_timesheet.group_hr_timesheet_user"
		action="action_timesheet_all_psi" sequence="3" />

	<menuitem name="Feuilles de temps à valider"  id="menu_timesheet_grid_validate"
		parent="hr_timesheet.timesheet_menu_root" groups="hr_timesheet.group_hr_timesheet_user"
		action="action_timesheet_previous_month_psi" sequence="10" />

	<menuitem name="Feuilles de temps à valider"
		id="menu_timesheet_grid_validate_previous_month_psi" parent="menu_timesheet_grid_validate"
		action="action_timesheet_previous_month_psi" />



	<delete id="timesheet_grid.menu_timesheet_grid_my" model="ir.ui.menu" />
	<delete id="hr_timesheet.menu_hr_working_hours" model="ir.ui.menu" />
	<delete id="timesheet_grid.menu_timesheet_grid_validate_previous_week"
		model="ir.ui.menu" />
	<delete id="timesheet_grid.menu_timesheet_grid_validate" model="ir.ui.menu" />
	<delete id="timesheet_grid.menu_timesheet_grid_validate_previous_month"
		model="ir.ui.menu" />

</odoo>
